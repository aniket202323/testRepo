
--=====================================================================================================================
--	Name:		 		fnLocal_SSI_Cmn_ErrorCodePromptId
--	Type:				Scalar Function
--	Editor Tab Spacing: 4	
--=====================================================================================================================
--	DESCRIPTION: 
--	This Function is in charge of returning a Prompt Id value associated to a specific Application Stored Procedure
--=====================================================================================================================
--	BUSINESS RULES:
--	If the query does not return a valid prompt value. The function should return -1
--=====================================================================================================================
--	EDIT HISTORY:
-----------------------------------------------------------------------------------------------------------------------
--	Revision	Date		Who					What
--	========	====		====				====
--	1.0			08-13-2012	Freddy Lavagni		Initial Development
--	1.1			2013-06-18	Michel St-Arnaud	Removed GRANT EXECUTE.
--=====================================================================================================================
--	EXEC Statement:
-----------------------------------------------------------------------------------------------------------------------
--	The DECLARE, SELECT, and Function parameter statements in the following example should match the function input
--	parameters.
/*
DECLARE	@p_vchAppName		VARCHAR(100)	,
		@p_vchObjectName	VARCHAR(265)	,
		@p_intErrorCode		INT		
SELECT	@p_vchAppName		= 'TEST'		,
		@p_vchObjectName	= 'TEST'		,
		@p_intErrorCode		= -1		
SELECT	dbo.fnLocal_SSI_Cmn_ErrorCodePromptId(
			@p_vchAppName		,	-- @p_vchAppName
			@p_vchObjectName	,	-- @p_vchObjectName
			@p_intErrorCode			-- @p_intErrorCode
	)
*/
--=====================================================================================================================
CREATE FUNCTION [dbo].[fnLocal_SSI_Cmn_ErrorCodePromptId](
	@p_vchAppName		VARCHAR(100)		,
	@p_vchObjectName	VARCHAR(256)		,
	@p_intErrorCode		INT					)
	
RETURNS INT
-----------------------------------------------------------------------------------------------------------------------
AS
BEGIN
	--=================================================================================================================
	--	DECLARE VARIABLES
	--	The following variables will be used as internal variables to this Stored Procedure.
	--=================================================================================================================
	--	INTEGER
	-------------------------------------------------------------------------------------------------------------------
	DECLARE	@intPromptId	INT
	-------------------------------------------------------------------------------------------------------------------
	--	VARCHAR
	-------------------------------------------------------------------------------------------------------------------
	
	-------------------------------------------------------------------------------------------------------------------
	--	DATETIME
	-------------------------------------------------------------------------------------------------------------------

	--=================================================================================================================
	--	DECLARE VARIABLE CONSTANTS
	--	The following variables will be used as internal constants to this Stored Procedure.
	--=================================================================================================================

	--=================================================================================================================
	--	DECLARE TABLE VARIABLES
	--	The following Table Variables will be used to store temporary datasets within this Stored Procedure.
	--=================================================================================================================

	--=================================================================================================================
	--	INITIALIZE VARIABLES and VARIABLE CONSTANTS
	--	Use this section to initialize variables and set valuse for any variable constants.
	--=================================================================================================================
 
	--=================================================================================================================
	--	VALIDATE INPUT PARAMETERS
	--=================================================================================================================
	-------------------------------------------------------------------------------------------------------------------
	--	Validate parameter @p_vchAppName
	-------------------------------------------------------------------------------------------------------------------
	IF	@p_vchAppName	IS NULL
	BEGIN
		RETURN NULL
	END
	-------------------------------------------------------------------------------------------------------------------
	--	Validate parameter @p_vchObjectName
	-------------------------------------------------------------------------------------------------------------------
	IF	@p_vchObjectName	IS NULL
	BEGIN
		RETURN NULL
	END
	-------------------------------------------------------------------------------------------------------------------
	--	Validate parameter @p_intErrorCode
	-------------------------------------------------------------------------------------------------------------------
	IF	@p_intErrorCode	IS NULL
	BEGIN
		RETURN NULL
	END
	--=================================================================================================================
	--	RETRIEVE AND VALIDATE EXTERNAL PARAMETERS
	--	Retrieve external parameter values, such as Site or User parameters or User Defined Properties.
	--=================================================================================================================

	--=================================================================================================================
	--	BEGIN LOGIC
	--=================================================================================================================
	SELECT	@intPromptId = e.Prompt_Id
	FROM dbo.Local_SSI_ErrorCodeMapping e WITH(NOLOCK)
	WHERE	e.App_Name = @p_vchAppName
	AND		e.Object_Name = @p_vchObjectName
	AND		e.Error_Code = @p_intErrorCode	
	--=================================================================================================================
	--	Return the value.
	--=================================================================================================================
	RETURN COALESCE (@intPromptId,-1)
--=====================================================================================================================
-- END FUNCTION
--=====================================================================================================================
END  
